[{"content":"RabbitMq ç”Ÿäº§è€…ç¡®è®¤æ¶ˆæ¯è¢«æ¶ˆè´¹ æ¢ç´¢ æ¶ˆè´¹è€…æ‰‹åŠ¨ackçš„ä¸€äº›çŠ¶æ€, ç”Ÿäº§è€…æ˜¯ä¸èƒ½å‡†ç¡®å¾—çŸ¥çš„.\nä¾‹å¦‚:\n1 2 // å¤„ç†å¤±è´¥ é‡æ–°è¿›å…¥é˜Ÿåˆ— ç»§ç»­æ¶ˆè´¹ channel.basicNack(msg.getMessageProperties().getDeliveryTag(), false,true); å½“æ¶ˆè´¹è€…æŠŠæ¶ˆæ¯é‡æ–°æ”¾å…¥é˜Ÿåˆ—, ç”Ÿäº§è€…æ˜¯ä¸çŸ¥é“çš„\nâ€¦.\nè€Œ ç”Ÿäº§è€…çš„ convertSendAndReceive è™½ç„¶å¯ä»¥å¾—çŸ¥è¿”å›ä¿¡æ¯, ä½†æ˜¯å®ƒæ˜¯æœ‰æ¬¡æ•°é™åˆ¶çš„, è€Œæ¬¡æ•°æ˜¯æå‰è®¾å®šå¥½çš„, å¦‚æœæ¬¡æ•°èŒƒå›´å†…æ²¡æœ‰å¤„ç†æˆåŠŸ, åˆ™ä¼šæ¥æ”¶åˆ°null.\næ‰€ä»¥ä»ä¸èƒ½å‡†ç¡®å¾—çŸ¥æ¶ˆè´¹è€…çš„çŠ¶æ€.\nç”Ÿäº§è€…ä¸èƒ½å‡†ç¡®å¾—çŸ¥æ¶ˆè´¹è€…æ˜¯å¦æˆåŠŸæ¶ˆè´¹äº†æ¶ˆæ¯ é…ç½®æ–‡ä»¶ application.ymlä¸­å¢åŠ é…ç½®\n1 2 3 4 spring: rabbitmq: publisher-confirms: true publisher-returns: true ç”Ÿäº§è€…å¯ä»¥å®ç° RabbitTemplate.ReturnCallback, æ¥è·å–æ¶ˆæ¯åœ¨å‘é€åˆ°è·¯ç”±æˆ–è€…é˜Ÿåˆ—ä¸­çš„å¤±è´¥ä¿¡æ¯\næ™®é€šåˆ›å»ºç±»æ–¹å¼\nå®šä¹‰ReturnCallBackService\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 @Component public class ReturnCallBackService implements RabbitTemplate.ReturnCallback { /** * å‘é€åˆ°è·¯ç”±æˆ–è€…é˜Ÿåˆ—ä¸­çš„å¤±è´¥ä¿¡æ¯ * * @param message the returned message. * @param replyCode the reply code. * @param replyText the reply text. * @param exchange the exchange. * @param routingKey the routing key. */ @Override public void returnedMessage(Message message, int replyCode, String replyText, String exchange, String routingKey) { System.out.println(\u0026#34;return--message:\u0026#34; + new String(message.getBody()) + \u0026#34;,replyCode:\u0026#34; + replyCode + \u0026#34;,replyText:\u0026#34; + replyText + \u0026#34;,exchange:\u0026#34; + exchange + \u0026#34;,routingKey:\u0026#34; + routingKey); } } ç”Ÿäº§è€…å‘é€æ¶ˆæ¯ä¹‹å‰è®¾ç½®\n1 rabbitTemplate.setReturnCallback(returnCallBackService); jdk8, åŒ¿åå‡½æ•°\nå‘é€æ¶ˆæ¯ä¹‹å‰è®¾ç½®\n1 2 3 4 rabbitTemplate.setReturnCallback((message, replyCode, replyText, exchange, routingKey) -\u0026gt; { logger.info(\u0026#34;send message failed: \u0026#34; + replyCode + \u0026#34; \u0026#34; + replyText); rabbitTemplate.send(message); }); ç”Ÿäº§è€…å¯ä»¥å®ç° RabbitTemplate.ConfirmCallback, æ¥ç¡®è®¤æ¶ˆæ¯æ˜¯å¦å‘é€åˆ°å…·ä½“è·¯ç”±æˆ–è€…é˜Ÿåˆ—\næ™®é€šåˆ›å»ºç±»æ–¹å¼\nå®šä¹‰ConfirmCallback\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 @Component public class ConfirmCallbackService implements RabbitTemplate.ConfirmCallback { /** * ç¡®è®¤æ¶ˆæ¯æ˜¯å¦å‘é€åˆ°å…·ä½“è·¯ç”±æˆ–è€…é˜Ÿåˆ— * * @param correlationData correlation data for the callback. * @param ack true for ack, false for nack * @param cause An optional cause, for nack, when available, otherwise null. */ @Override public void confirm(CorrelationData correlationData, boolean ack, String cause) { System.out.println(\u0026#34;correlationData.getId() = \u0026#34; + correlationData.getId()); System.out.println(\u0026#34;ack = \u0026#34; + ack); if (ack){ System.err.println(\u0026#34;===============æ¶ˆæ¯å‘é€æˆåŠŸ============\u0026#34;); }else { //å‘é€å¤±è´¥ System.err.println(\u0026#34;================å¤±è´¥==================\u0026#34;); } System.out.println(\u0026#34;cause = \u0026#34; + cause); } } ç”Ÿäº§è€…å‘é€æ¶ˆæ¯ä¹‹å‰è®¾ç½®\n1 rabbitTemplate.setConfirmCallback(confirmCallbackService); jdk8, åŒ¿åå‡½æ•°\nå‘é€æ¶ˆæ¯ä¹‹å‰è®¾ç½®\n1 2 3 4 5 6 7 8 9 rabbitTemplate.setConfirmCallback((correlationData, ack, cause) -\u0026gt; { if (ack) { logger.info(\u0026#34;send message success: data [\u0026#34; + correlationData.getId() + \u0026#34;]\u0026#34;); // æ¸…é™¤é‡è¯•æœºåˆ¶ç¼“å­˜ // retryCache.del(Long.valueOf(correlationData.getId())); } else { logger.info(\u0026#34;send message failed: \u0026#34; + cause + correlationData.toString()); } }); æ‰‹åŠ¨ack æ¶ˆè´¹è€…çš„ @RabbitListener æ³¨è§£ä¸­æœ‰ containerFactory å­—æ®µ, å¯ä»¥æŒ‡å®šä¸€ä¸ªè‡ªå®šä¹‰çš„ containerFactory .\nåˆ›å»ºè‡ªå®šä¹‰å¯ä»¥æ‰‹åŠ¨ackçš„ containerFactory:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 @Configuration public class ConsumeConfig { @Resource ConnectionFactory connectionFactory; @Bean(\u0026#34;rabbitListenerContainerFactoryAck\u0026#34;) public RabbitListenerContainerFactory\u0026lt;?\u0026gt; rabbitListenerContainerFactoryAck(){ SimpleRabbitListenerContainerFactory factory = new SimpleRabbitListenerContainerFactory(); factory.setConnectionFactory(connectionFactory); factory.setAcknowledgeMode(AcknowledgeMode.MANUAL); return factory; } } åœ¨éœ€è¦æ‰‹åŠ¨ackçš„æ–¹æ³•ä¸ŠæŒ‡å®š bean\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 @RabbitListener(queues = \u0026#34;update.crm.staff\u0026#34;,containerFactory = \u0026#34;rabbitListenerContainerFactoryAck\u0026#34;) @RabbitHandler public void updateCrmStaff(Channel channel, Message msg){ System.err.println(\u0026#34;========================æ¶ˆè´¹å¼€å§‹================\u0026#34;); try { byte[] body = msg.getBody(); String s = new String(body); JSONObject crmAgent = JSONObject.parseObject(s); // å¤„ç†å¤±è´¥ é‡æ–°è¿›å…¥é˜Ÿåˆ— ç»§ç»­æ¶ˆè´¹ channel.basicNack(msg.getMessageProperties().getDeliveryTag(), false,true); } catch (IOException e) { e.printStackTrace(); try { //å¤„ç†å¤±è´¥,ä¸¢å¼ƒæ¶ˆæ¯ channel.basicNack(msg.getMessageProperties().getDeliveryTag(), false,false); } catch (IOException e1) { e1.printStackTrace(); } } // æ‰‹åŠ¨ç¡®è®¤æ¶ˆè´¹ channel.basicAck(msg.getMessageProperties().getDeliveryTag(), false); System.err.println(\u0026#34;========================æ¶ˆè´¹ç»“æŸ================\u0026#34;); } } ","permalink":"https://habyss.github.io/posts/tech/rabbitmq_ack/","summary":"RabbitMq ç”Ÿäº§è€…ç¡®è®¤æ¶ˆæ¯è¢«æ¶ˆè´¹ æ¢ç´¢ æ¶ˆè´¹è€…æ‰‹åŠ¨ackçš„ä¸€äº›çŠ¶æ€, ç”Ÿäº§è€…æ˜¯ä¸èƒ½å‡†ç¡®å¾—çŸ¥çš„. ä¾‹å¦‚: 1 2 // å¤„ç†å¤±è´¥ é‡æ–°è¿›å…¥é˜Ÿåˆ— ç»§ç»­æ¶ˆè´¹ channel.basicNack(msg.getMessageProperties().getDeliveryTag(), false,true); å½“æ¶ˆè´¹è€…æŠŠæ¶ˆæ¯é‡æ–°","title":"rabbitmq ack æ¢ç´¢"},{"content":"é«˜å¹¶å‘æƒ…å†µä¸‹ RabbitMQ æœåŠ¡é™æµ springä¸‹é»˜è®¤ä¸º250, è‹¥é»˜å†™æœåŠ¡éœ€è¦é™æµæˆ–è€…éœ€è¦å¼ºåˆ¶é¡ºåºæ€§æ‰§è¡Œ, åˆ™éœ€è¦è‡ªå®šä¹‰qos\n1 2 3 4 5 @RabbitHandler @RabbitListener(queues = QueueConstant.RE_SMS_ORDER_NOT_PAID_QUEUE) public void process(Channel channel, Message message) throws IOException { channel.basicQos(12); } å¤šä¸ªæ¶ˆè´¹è€…åŒæ—¶æ¶ˆè´¹ä¸€ä¸ªæ¶ˆæ¯ ä½¿ç”¨å¹¿æ’­æ¨¡å¼, ç›‘å¬æ—¶ä¸æŒ‡å®šé˜Ÿåˆ—, åˆ™ä¼šäº§ç”Ÿéšå³é˜Ÿåˆ—\nä¸ºäº†é˜²æ­¢ç³»ç»Ÿè¿­ä»£é‡å¯äº§ç”Ÿçš„å¤§é‡éšæœºé˜Ÿåˆ—, éœ€è¦æ–­å¼€æ—¶åˆ é™¤éšæœºé˜Ÿåˆ—\n1 2 3 4 5 @RabbitListener(bindings = @QueueBinding( //æ³¨æ„è¿™é‡Œä¸è¦å®šä¹‰é˜Ÿåˆ—åç§°,ç³»ç»Ÿä¼šéšæœºäº§ç”Ÿ value = @Queue(exclusive = \u0026#34;true\u0026#34;),// exclusive = \u0026#34;true\u0026#34; æ–­å¼€æ—¶åˆ é™¤éšæœºé˜Ÿåˆ— é¿å…ç³»ç»Ÿè¿­ä»£é‡å¯äº§ç”Ÿçš„å¤§é‡éšæœºé˜Ÿåˆ— exchange = @Exchange(value = \u0026#34;å¡«å†™äº¤æ¢æœºåç§°\u0026#34;, type = ExchangeTypes.FANOUT) )) ","permalink":"https://habyss.github.io/posts/tech/rabbitmq_qos_random/","summary":"é«˜å¹¶å‘æƒ…å†µä¸‹ RabbitMQ æœåŠ¡é™æµ springä¸‹é»˜è®¤ä¸º250, è‹¥é»˜å†™æœåŠ¡éœ€è¦é™æµæˆ–è€…éœ€è¦å¼ºåˆ¶é¡ºåºæ€§æ‰§è¡Œ, åˆ™éœ€è¦è‡ªå®šä¹‰qos 1 2 3 4 5 @RabbitHandler @RabbitListener(queues = QueueConstant.RE_SMS_ORDER_NOT_PAID_QUEUE) public void process(Channel channel, Message message)","title":"rabbitmqé™æµQos å¤šä¸ªæ¶ˆè´¹è€…åŒæ—¶æ¶ˆè´¹ä¸€ä¸ªæ¶ˆæ¯"},{"content":"æ–¹å¼ä¸€: åŸç”ŸRabbitMqå»¶æ—¶é˜Ÿåˆ— ğŸ’¡ç¼ºç‚¹: æ¯ä¸ªé˜Ÿåˆ—çš„æ¶ˆæ¯æ˜¯é¡ºåºçš„, é åçš„è¿‡æœŸæ—¶é—´çŸ­çš„æ¶ˆæ¯å¹¶ä¸èƒ½å…ˆæ‰§è¡Œ\né…ç½®é˜Ÿåˆ— æœºåˆ¶\nâ€œæ­»ä¿¡â€æ˜¯RabbitMQä¸­çš„ä¸€ç§æ¶ˆæ¯æœºåˆ¶ï¼Œå½“ä½ åœ¨æ¶ˆè´¹æ¶ˆæ¯æ—¶ï¼Œå¦‚æœé˜Ÿåˆ—é‡Œçš„æ¶ˆæ¯å‡ºç°ä»¥ä¸‹æƒ…å†µï¼š\næ¶ˆæ¯è¢«å¦å®šç¡®è®¤ï¼Œä½¿ç”¨ channel.basicNack æˆ– channel.basicReject ï¼Œå¹¶ä¸”æ­¤æ—¶requeue å±æ€§è¢«è®¾ç½®ä¸ºfalseã€‚ æ¶ˆæ¯åœ¨é˜Ÿåˆ—çš„å­˜æ´»æ—¶é—´è¶…è¿‡è®¾ç½®çš„TTLæ—¶é—´ã€‚ æ¶ˆæ¯é˜Ÿåˆ—çš„æ¶ˆæ¯æ•°é‡å·²ç»è¶…è¿‡æœ€å¤§é˜Ÿåˆ—é•¿åº¦ã€‚ æ€è·¯:\nå£°æ˜ä¸€ä¸ªé»˜è®¤é˜Ÿåˆ— æˆ– äº¤æ¢æœºç»‘å®šçš„é˜Ÿåˆ—, ä¸è®¾ç½®æ¶ˆè´¹è€…, ç§°ä¸ºæ­»ä¿¡é˜Ÿåˆ— æ­»ä¿¡é˜Ÿåˆ—è®¾ç½®è½¬å‘äº¤æ¢æœºä»¥åŠè·¯ç”± ç”Ÿäº§è€…è®¾ç½®æ¶ˆæ¯è¿‡æœŸæ—¶é—´ æˆ– æ­»ä¿¡é˜Ÿåˆ—ç»Ÿä¸€è®¾ç½®è¿‡æœŸæ—¶é—´ è¿‡æœŸåè½¬å‘è‡³æ–°çš„äº¤æ¢æœº/é˜Ÿåˆ—è¿›è¡Œæ¶ˆè´¹ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 @Component public class DelayRabbitSmsOrderConfig { /** * é‡å‘ */ public static final String RE_SMS_ORSER_EXCHANGE = \u0026#34;re.sms.order\u0026#34;; public static final String RE_SMS_ORDER_NOT_PAID_K = \u0026#34;re.sms.order.not.k.paid\u0026#34;; public static final String RE_SMS_ORDER_NOT_PAID_QUEUE = \u0026#34;re.sms.order.not.q.paid\u0026#34;; /** * æ­»ä¿¡ */ public static final String DL_SMS_ORSER_EXCHANGE = \u0026#34;dead.sms.order\u0026#34;; public static final String DL_SMS_ORDER_NOT_PAID_K = \u0026#34;dead.sms.order.not.k.paid\u0026#34;; public static final String DL_SMS_ORDER_NOT_PAID_QUEUE = \u0026#34;dead.sms.order.not.q.paid\u0026#34;; /** * å£°æ˜é‡å‘äº¤æ¢æœº */ @Bean public Exchange reExchange() { return ExchangeBuilder .directExchange(RE_SMS_ORSER_EXCHANGE) .durable(true) .build(); } /** * å£°æ˜é‡å‘é˜Ÿåˆ— */ @Bean public Queue reQueue() { return QueueBuilder .durable(RE_SMS_ORDER_NOT_PAID_QUEUE) .build(); } /** * ç»‘å®šé‡å‘äº¤æ¢æœº é‡å‘è·¯ç”± */ @Bean public Binding reExchangeBinding(Exchange reExchange, Queue reQueue) { return BindingBuilder .bind(reQueue) .to(reExchange) .with(RE_SMS_ORDER_NOT_PAID_K) .noargs(); } /** * å£°æ˜æ­»ä¿¡é˜Ÿåˆ— */ @Bean public Queue dlQueue() { Map\u0026lt;String, Object\u0026gt; args = new HashMap\u0026lt;\u0026gt;(4); // æŒ‡å®šè¿‡æœŸä¹‹åçš„äº¤æ¢æœºä¸ºé‡å‘äº¤æ¢æœº args.put(\u0026#34;x-dead-letter-exchange\u0026#34;, RE_SMS_ORSER_EXCHANGE); // æŒ‡å®šè¿‡æœŸä¹‹åçš„è·¯ç”±ä¸ºé‡å‘è·¯ç”± args.put(\u0026#34;x-dead-letter-routing-key\u0026#34;, RE_SMS_ORDER_NOT_PAID_K); // ç»Ÿä¸€çš„æ¯«ç§’å•ä½è¿‡æœŸ å¦‚æœè¿‡æœŸæ—¶é—´æ˜¯åŠ¨æ€çš„,éœ€è¦rabbitMqæ’ä»¶,å¹¶åœ¨æ¯æ¡æ¶ˆæ¯ä¸Šè®¾ç½®è¿‡æœŸæ—¶é—´ args.put(\u0026#34;x-expires\u0026#34;, \u0026#34;600000\u0026#34;); return QueueBuilder .durable(DL_SMS_ORDER_NOT_PAID_QUEUE) .withArguments(args) .build(); } // ä¸‹é¢ä¸¤ä¸ªå¯ä¸è®¾ç½®, åˆ™æ¶ˆè´¹è€…å‘æ¶ˆæ¯çš„æ—¶å€™ä¸è®¾ç½®äº¤æ¢æœºå’Œè·¯ç”±(å³ä½¿ç”¨é»˜è®¤çš„äº¤æ¢æœº) /** * å£°æ˜æ­»ä¿¡äº¤æ¢æœº */ @Bean public Exchange dlExchange() { return ExchangeBuilder .directExchange(DL_SMS_ORSER_EXCHANGE) .durable(true) .build(); } /** * ç»‘å®šæ­»ä¿¡äº¤æ¢æœº æ­»ä¿¡è·¯ç”± */ @Bean public Binding dlExchangeBinding(Exchange dlExchange, Queue dlQueue) { return BindingBuilder .bind(dlQueue) .to(dlExchange) .with(DL_SMS_ORDER_NOT_PAID_K) .noargs(); } } ç”Ÿäº§è€… 1 2 3 4 5 6 7 8 9 10 11 12 // å»¶æ—¶ åˆ›å•10minæœªæ”¯ä»˜ Message msg = MessageBuilder.withBody(params.getBytes()) .setContentType(MessageProperties.CONTENT_TYPE_JSON) .setContentEncoding(\u0026#34;utf-8\u0026#34;) // è‹¥ä¸Šé¢é…ç½®è®¾ç½®äº†æ­»ä¿¡äº¤æ¢æœº/æ­»ä¿¡è·¯ç”± åˆ™é…ç½®ä¸Š .setReceivedExchange(\u0026#34;\u0026#34;) .setReceivedRoutingKey(\u0026#34;\u0026#34;) .setMessageId(UUID.randomUUID() + \u0026#34;\u0026#34;) // è‹¥ä¸Šé¢é…ç½®è®¾ç½®äº†ç»Ÿä¸€çš„æ¯«ç§’å•ä½è¿‡æœŸ, åˆ™ä¸ç”¨é…ç½® .setExpiration(\u0026#34;600000\u0026#34;) .build(); amqpTemplate.convertAndSend(QueueConstant.DEAD_SMS_ORDER_QUEUE, msg); æ¶ˆè´¹è€… 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 @Component public class SmsPushNotPaidReceiver { public static final Logger logger = LoggerFactory.getLogger(SmsPushNotPaidReceiver.class); @RabbitHandler // ç›‘å¬é‡å‘é˜Ÿåˆ— @RabbitListener(queues = QueueConstant.RE_SMS_ORDER_NOT_PAID_QUEUE) public void process(Message message) { logger.info(\u0026#34;----------- sms.notPayOrder start -----------\u0026#34;); String params = new String(message.getBody(), StandardCharsets.UTF_8); JSONObject param = JSONObject.parseObject(params); String code = param.getString(\u0026#34;code\u0026#34;); logger.info(\u0026#34;----------- sms.notPayOrder end -----------\u0026#34;); } } æ–¹å¼äºŒ: æ’ä»¶RabbitMqå»¶æ—¶é˜Ÿåˆ— ğŸ’¡ æ²¡æœ‰äº†åŸç”Ÿçš„ç¼ºç‚¹..\nğŸ’¡ éœ€è¦åœ¨æœåŠ¡å™¨ä¸Šè‡ªå·±è£…å»¶æ—¶é˜Ÿåˆ—çš„æ’ä»¶, ç®€å•\né…ç½®é˜Ÿåˆ— 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 @Bean CustomExchange delayExchange() { //åˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰äº¤æ¢æœºï¼Œå¯ä»¥å‘é€å»¶è¿Ÿæ¶ˆæ¯ Map\u0026lt;String, Object\u0026gt; args = new HashMap\u0026lt;\u0026gt;(); args.put(\u0026#34;x-delayed-type\u0026#34;, \u0026#34;direct\u0026#34;); return new CustomExchange(QueueEnum.QUEUE_CONSULTATION_END.getExchange(), \u0026#34;x-delayed-message\u0026#34;, true, false, args); } // æ·»åŠ å…¶ä»–å»¶æ—¶é˜Ÿåˆ—æ—¶, é‡å¤ä¸‹é¢ä¸¤ä¸ª @Bean public Queue consultationEndDelayQueue() { return new Queue(QueueEnum.QUEUE_CONSULTATION_END.getQueueName(), true); } @Bean public Binding consultationEndDelayBinding(CustomExchange delayExchange, Queue consultationEndDelayQueue) { return BindingBuilder .bind(consultationEndDelayQueue) .to(delayExchange) .with(QueueEnum.QUEUE_CONSULTATION_END.getRoutingKey()) .noargs(); } ç”Ÿäº§è€… 1 2 3 4 5 6 7 8 9 10 11 CommonEvent commonEvent = new CommonEvent().setId(id); long delayTime = timeoutConstant.getImageTextAutoEnd() * 60 * 60 * 1000L; rabbitTemplate.convertAndSend( QueueEnum.QUEUE_CONSULTATION_END.getExchange(), QueueEnum.QUEUE_CONSULTATION_END.getRoutingKey(), commonEvent, message -\u0026gt; { //ç»™æ¶ˆæ¯è®¾ç½®å»¶è¿Ÿæ¯«ç§’å€¼ message.getMessageProperties().setHeader(\u0026#34;x-delay\u0026#34;, delayTime); return message; }); æ¶ˆè´¹è€… 1 2 3 4 5 6 7 8 9 @Component @RabbitListener(queues = \u0026#34;consultation.end\u0026#34;) public class ConsultationCancelReceiver { @RabbitHandler public void handle(CommonEvent commonEvent) { } } ","permalink":"https://habyss.github.io/posts/tech/rabbitmq_delay/","summary":"æ–¹å¼ä¸€: åŸç”ŸRabbitMqå»¶æ—¶é˜Ÿåˆ— ğŸ’¡ç¼ºç‚¹: æ¯ä¸ªé˜Ÿåˆ—çš„æ¶ˆæ¯æ˜¯é¡ºåºçš„, é åçš„è¿‡æœŸæ—¶é—´çŸ­çš„æ¶ˆæ¯å¹¶ä¸èƒ½å…ˆæ‰§è¡Œ é…ç½®é˜Ÿåˆ— æœºåˆ¶ â€œæ­»ä¿¡â€æ˜¯RabbitMQ","title":"rabbitmqå®ç°å»¶æ—¶é˜Ÿåˆ—"},{"content":"æ–¹å¼ä¸€: åŸºäºè¡¨è¾¾å¼ ä¾‹å¦‚ç®€å•æ—¥å¿—æ‰“å°:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 @Slf4j @Aspect @Component public class WebLogAspect { /** * xxxåŒ…åŠå…¶å­åŒ…ä¸‹çš„ä»¥Controllerç»“å°¾çš„ç±»çš„ä»»æ„æ–¹æ³• */ @Pointcut(\u0026#34;execution(public * com.xxx..*Controller.*(..))\u0026#34;) public void webLog(){} @Around(\u0026#34;webLog()\u0026#34;) public Object around(ProceedingJoinPoint jp) throws Throwable { StopWatch sw = new StopWatch(\u0026#34;è¯·æ±‚è€—æ—¶\u0026#34;); ServletRequestAttributes attributes = (ServletRequestAttributes) RequestContextHolder.getRequestAttributes(); HttpServletRequest request = Objects.requireNonNull(attributes).getRequest(); sw.start(); log.info(\u0026#34;---è¯·æ±‚æ¥æº : {}\u0026#34;, IpUtil.getIpAddress(request)); log.info(\u0026#34;---è¯·æ±‚æ–¹æ³• : {}.{}\u0026#34;, jp.getSignature().getDeclaringTypeName(), jp.getSignature().getName()); log.info(\u0026#34;---è¯·æ±‚å‚æ•° : {}\u0026#34;, Arrays.toString(jp.getArgs())); Object result = jp.proceed(); sw.stop(); log.info(\u0026#34;---è¯·æ±‚è€—æ—¶ : {}{}\u0026#34;, sw.getLastTaskTimeMillis(), \u0026#34;ms\u0026#34;); log.info(\u0026#34;---è¯·æ±‚è¿”å› : {}\u0026#34;, result); return result; } } æ–¹å¼äºŒ: åŸºäºæ³¨è§£ è¯´æ˜\n@Target({ElementType.TYPE, ElementType.METHOD}) ï¼šå…è®¸ä½¿ç”¨çš„åœ°æ–¹ï¼›å¦‚-ElementType.TYPE==ã€‹ç±»ï¼›ElementType.METHOD==ã€‹æ–¹æ³•\n@Retention(RetentionPolicy.RUNTIME)ï¼šæ³¨è§£ä¿ç•™åœ¨ç¨‹åºè¿è¡ŒæœŸé—´ï¼Œæ­¤æ—¶å¯ä»¥é€šè¿‡åå°„è·å¾—å®šä¹‰åœ¨æŸä¸ªç±»ä¸Šçš„æ‰€æœ‰æ³¨è§£\n@Inheritedï¼šå½“@Inheritedä¿®é¥°è¿‡çš„æ³¨è§£åŠ åœ¨æŸä¸ªç±»Aä¸Šæ—¶ï¼Œå‡å¦‚ç±»Bç»§æ‰¿äº†Aï¼Œåˆ™Bä¹Ÿä¼šå¸¦ä¸Šè¯¥æ³¨è§£ã€‚åŠ åœ¨æ¥å£ä¸Šæ— æ•ˆ\nä¾‹å¦‚åŸºäºæ³¨è§£çš„redisç¼“å­˜å®ç°:\nå®šä¹‰æ³¨è§£\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 @Retention(RetentionPolicy.RUNTIME) // ä¸€èˆ¬æ˜¯è¿è¡Œæ—¶ @Target(ElementType.METHOD) // æ³¨è§£çº§åˆ« æ­¤å¤„ä¸ºæ–¹æ³•çº§ @Order(Ordered.HIGHEST_PRECEDENCE) // ä¼˜å…ˆçº§ public @interface RedisCache { /** * key * * @return {@link String} */ String key(); /** * è¿‡æœŸæ—¶é—´ * * @return int */ long expire() default 1; /** * æ—¶é—´å•ä½ * * @return {@link TimeUnit} */ TimeUnit timeUnit() default TimeUnit.DAYS; /** * æ–¹æ³•è¿”å›ä¸ºlisté›†åˆæ—¶ å¿…ä¼  å¦åˆ™å‡ºé”™ * * @return {@link Class} */ Class\u0026lt;?\u0026gt; listForClass() default RedisCache.class; } ä¸ºæ³¨è§£å¢åŠ aopç›¸å…³å®ç°\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 @Aspect @Component @Slf4j public class RedisCacheContract { @Resource RedisUtil redisUtil; @Around(\u0026#34;@annotation(redisCache)\u0026#34;) public Object redisAround(final ProceedingJoinPoint joinPoint, RedisCache redisCache) throws Throwable { Object result; MethodSignature signature = (MethodSignature) joinPoint.getSignature(); String key = redisCache.key() + \u0026#34;:\u0026#34; + Arrays.toString(joinPoint.getArgs()); if (redisUtil.hasKey(key)) { log.info(\u0026#34;hint redisCache {}\u0026#34;, key); // é»˜è®¤æ³¨è§£ ç›´æ¥ä½¿ç”¨åŸæ–¹æ³•çš„returnTypeæ¥è§£æjson if (redisCache.listForClass().isAssignableFrom(RedisCache.class)) { Class\u0026lt;?\u0026gt; returnType = signature.getReturnType(); result = redisUtil.get(key, returnType); if (result instanceof ResponseResult\u0026lt;?\u0026gt; r) { // è®¾ç½®æ–°çš„traceId r.setTraceId(TraceIdUtil.getTraceId()); } } else { // listæ³¨è§£, ä½¿ç”¨è‡ªå®šä¹‰classè§£æä¸ºList result = redisUtil.getAsList(key, redisCache.listForClass()); } } else { result = joinPoint.proceed(); redisUtil.set(key, result, redisCache.expire(), redisCache.timeUnit()); } return result; } } ğŸ’¡ ä¸€èˆ¬æƒ…å†µä¸‹, è¿™ä¸¤ç§è¶³å¤Ÿä½¿ç”¨äº†.\n","permalink":"https://habyss.github.io/posts/tech/springboot_aop/","summary":"æ–¹å¼ä¸€: åŸºäºè¡¨è¾¾å¼ ä¾‹å¦‚ç®€å•æ—¥å¿—æ‰“å°: 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 @Slf4j @Aspect @Component public class WebLogAspect { /** * xxxåŒ…åŠå…¶å­åŒ…ä¸‹çš„ä»¥Contro","title":"åŸºäºspringbootå¸¸ç”¨aopæ–¹å¼"},{"content":"UMLç±»å›¾å…³ç³» ğŸ’¡ UML å…¨ç§°Unified Modeling Language, ç»Ÿè®¡å»ºæ¨¡è¯­è¨€.\nUMLç±»å›¾ä¸­æœ‰å…­ç§å…³ç³»ï¼Œä»å¼±åˆ°å¼ºä¾æ¬¡æ˜¯ï¼š\nä¾èµ–å…³ç³» \u0026lt; å…³è”å…³ç³» \u0026lt; èšåˆå…³ç³» \u0026lt; ç»„åˆå…³ç³» \u0026lt; å®ç°å…³ç³» = æ³›åŒ–å…³ç³»\nç±»çš„æˆå‘˜å˜é‡å’Œæ–¹æ³•å‰é¢çš„ä¿®é¥°ç¬¦æœ‰public, private, protected, defaultï¼Œåœ¨UMLç±»å›¾ä¸­åˆ†åˆ«ç”¨ +, -, #, ~è¡¨ç¤ºã€‚\n1. ä¾èµ–å…³ç³» é€šç”¨æè¿°: ä¾èµ–å…³ç³»è¡¨ç¤ºæŸä¸ªç±»ä¾èµ–äºå¦å¤–ä¸€ä¸ªç±»\nä»£ç è¡¨ç°: æŸä¸ªç±»çš„æ–¹æ³•çš„å‚æ•°ä½¿ç”¨äº†å¦å¤–ä¸€ä¸ªç±»çš„å¯¹è±¡\nç®­å¤´æè¿°: ä¾èµ–å…³ç³»ä½¿ç”¨å¸¦ç®­å¤´çš„è™šçº¿è¡¨ç¤º, ç®­å¤´æŒ‡å‘è¢«ä¾èµ–çš„ç±»\nç¤ºä¾‹å›¾æ ·:\n2. å…³è”å…³ç³» é€šç”¨æè¿°: å…³è”å…³ç³»è¡¨ç¤ºä¸€ä¸ªç±»å’Œå¦å¤–ä¸€ä¸ªç±»çš„è”ç³», å¦‚è€å¸ˆå’Œå­¦ç”Ÿ\nä»£ç è¡¨ç°: æŸä¸ªç±»çš„æˆå‘˜å˜é‡æ˜¯å¦å¤–ä¸€ä¸ªç±»çš„å¯¹è±¡\nç®­å¤´æè¿°: ä¾èµ–å…³ç³»æœ‰å•å‘å’ŒåŒå‘, å•å‘ä½¿ç”¨å¸¦ç®­å¤´çš„å®çº¿è¡¨ç¤º, ç®­å¤´æŒ‡å‘è¢«å…³è”çš„ç±», åŒå‘ä½¿ç”¨åŒç®­å¤´æˆ–è€…æ²¡æœ‰ç®­å¤´çš„å®çº¿è¡¨ç¤º.\nç¤ºä¾‹å›¾æ ·:\n3. èšåˆå…³ç³» é€šç”¨æè¿°: èšåˆå…³ç³»æ˜¯å…³è”å…³ç³»çš„ä¸€ç§, è¡¨ç¤ºçš„æ˜¯æ•´ä½“ä¸éƒ¨åˆ†ä¹‹é—´çš„å…³ç³», å¦‚å­¦æ ¡å’Œè€å¸ˆ, è½¦å­å’Œè½®èƒ\nä»£ç è¡¨ç°: æŸä¸ªç±»çš„æˆå‘˜å˜é‡æ˜¯å¦å¤–ä¸€ä¸ªç±»çš„å¯¹è±¡\nç®­å¤´æè¿°: èšåˆå…³ç³»ä½¿ç”¨å¸¦ç©ºå¿ƒè±å½¢çš„å®çº¿è¡¨ç¤º, è±å½¢æŒ‡å‘æ•´ä½“\nç¤ºä¾‹å›¾æ ·:\n4. ç»„åˆå…³ç³» é€šç”¨æè¿°: ç»„åˆå…³ç³»æ˜¯å…³è”å…³ç³»çš„ä¸€ç§, æ˜¯ä¸€ç§æ¯”èšåˆå…³ç³»æ›´å¼ºçš„ä¸€ç§å…³ç³», éƒ¨åˆ†ä¸èƒ½è„±ç¦»æ•´ä½“è€Œå•ç‹¬å­˜åœ¨, å¦‚èº«ä½“å’Œå¤§è„‘\nä»£ç è¡¨ç°: æŸä¸ªç±»çš„æˆå‘˜å˜é‡æ˜¯å¦å¤–ä¸€ä¸ªç±»çš„å¯¹è±¡\nç®­å¤´æè¿°: ç»„åˆå…³ç³»ä½¿ç”¨å¸¦å®å¿ƒè±å½¢çš„å®çº¿è¡¨ç¤º, è±å½¢æŒ‡å‘æ•´ä½“\nç¤ºä¾‹å›¾æ ·:\n5. å®ç°å…³ç³» é€šç”¨æè¿°: å®ç°å…³ç³»æ˜¯æ¥å£å’Œå®ç°ç±»ä¹‹é—´çš„å…³ç³»\nä»£ç è¡¨ç°: æ¥å£å’Œå®ç°ç±»\nç®­å¤´æè¿°: å®ç°å…³ç³»ä½¿ç”¨å¸¦ç©ºå¿ƒä¸‰è§’ç®­å¤´çš„è™šçº¿è¡¨ç¤º, ç®­å¤´æŒ‡å‘æ¥å£\nç¤ºä¾‹å›¾æ ·:\n6. æ³›åŒ–å…³ç³» é€šç”¨æè¿°: æ³›åŒ–å…³ç³»æ˜¯çˆ¶å­ç±»ä¹‹é—´çš„ç»§æ‰¿å…³ç³»\nä»£ç è¡¨ç°: æŠ½è±¡çˆ¶å­ä¸å­ç±», ç»§æ‰¿\nç®­å¤´æè¿°: æ³›åŒ–å…³ç³»ä½¿ç”¨å¸¦ç©ºå¿ƒä¸‰è§’ç®­å¤´çš„å®çº¿æ¥è¡¨ç¤º, ç®­å¤´æŒ‡å‘çˆ¶ç±»\nç¤ºä¾‹å›¾æ ·:\næ€»ç»“ ä¾èµ–å…³ç³» \u0026lt; å…³è”å…³ç³» \u0026lt; èšåˆå…³ç³» \u0026lt; ç»„åˆå…³ç³» \u0026lt; å®ç°å…³ç³» = æ³›åŒ–å…³ç³» å…³ç³»åç§° ä»£ç è¡¨ç° ç®­å¤´å½¢å¼ ç®­å¤´æŒ‡å‘ ä¾èµ–å…³ç³» æ–¹æ³•å‚æ•° è™šçº¿ç®­å¤´ æŒ‡å‘è¢«ä¾èµ–çš„ç±»(æ–¹æ³•å‚æ•°çš„ç±») å…³è”å…³ç³» æˆå‘˜å˜é‡ å®çº¿ç®­å¤´ æŒ‡å‘è¢«å…³è”çš„ç±»(æˆå‘˜å˜é‡çš„ç±») èšåˆå…³ç³» æˆå‘˜å˜é‡ å®çº¿ç©ºå¿ƒè±å½¢ æŒ‡å‘æ•´ä½“ ç»„åˆå…³ç³» æˆå‘˜å˜é‡ å®çº¿å®å¿ƒè±å½¢ æŒ‡å‘æ•´ä½“ å®ç°å…³ç³» æ¥å£ä¸å®ç°ç±» è™šçº¿ç©ºå¿ƒä¸‰è§’ æŒ‡å‘æ¥å£ æ³›åŒ–å…³ç³» æŠ½è±¡çˆ¶ç±»ä¸å­ç±» å®çº¿ç©ºå¿ƒä¸‰è§’ æŒ‡å‘çˆ¶ç±» ","permalink":"https://habyss.github.io/posts/tech/uml/","summary":"UMLç±»å›¾å…³ç³» ğŸ’¡ UML å…¨ç§°Unified Modeling Language, ç»Ÿè®¡å»ºæ¨¡è¯­è¨€. UMLç±»å›¾ä¸­æœ‰å…­ç§å…³ç³»ï¼Œä»å¼±åˆ°å¼ºä¾æ¬¡æ˜¯ï¼š ä¾èµ–å…³ç³» \u0026lt; å…³è”å…³ç³» \u0026lt; èšåˆå…³ç³» \u0026lt; ç»„åˆå…³ç³» \u0026lt; å®ç°å…³","title":"UMLç±»å›¾å…³ç³»"},{"content":"@Transactionalå¤±æ•ˆ æ•´åˆshiroä¹‹åï¼ŒUserRealmç±»é‡Œè‡ªåŠ¨æ³¨å…¥çš„serviceä¸­çš„@Transactionalæ³¨è§£å¤±æ•ˆ\nè§£å†³æ–¹æ³• ä½¿ç”¨@Lazyæ³¨è§£\n1 2 3 @Autowired @Lazy private OperationUnitService operationUnitService; åœ¨Realmä¸­ç›´æ¥ä½¿ç”¨mapperï¼Œè€Œä¸æ˜¯service\n1 2 @Autowired private OperationUnitMapper operationUnitMapper; ApplicationContextRegister.getBean()æ–¹æ³•ï¼Œæ‰‹åŠ¨æ³¨å…¥bean\n1 OperationUnitService operationUnitService = ApplicationContextRegister.getBean(OperationUnitService.class) äº§ç”ŸåŸå›  åœ¨shiroä¸­ä¸ºäº†å¼•å…¥æƒé™æ³¨è§£ï¼Œé…ç½®äº†defaultAdvisorAutoProxyCreatorå’ŒauthorizationAttributeSourceAdvisorç±»ï¼Œä»–ä»¬æ˜¯é€šè¿‡AOPæ–¹å¼å¯¹@RequiredPermissionç±»/æ–¹æ³•(æƒé™æ§åˆ¶)è¿›è¡Œå¢å¼º.\nç”Ÿæˆå¯¹åº”çš„ä»£ç†ç±»å¯¹è±¡ï¼Œç”±äºshiroFilterFactoryBeanå®ç°äº†factoryBeanæ¥å£ï¼Œæ‰€ä»¥ä¼šè¢«æå‰åˆå§‹åŒ–ï¼Œæ‰€ä»¥å¼•å‘æ‰€æœ‰ç›¸å…³çš„beanæå‰åˆå§‹åŒ–ï¼Œå¯¼è‡´ä»–ä»¬æ²¡æœ‰è¢«äº‹åŠ¡AOPåŒ…è£¹ç€ï¼Œä»è€Œå¼•å‘äº‹åŠ¡æ— æ•ˆçš„é—®é¢˜\n1 2 3 4 5 6 7 8 9 10 11 /** * å¼€å¯Shiroçš„æ³¨è§£(å¦‚@RequiresRoles,@RequiresPermissions),éœ€å€ŸåŠ©SpringAOPæ‰«æä½¿ç”¨Shiroæ³¨è§£çš„ç±»,å¹¶åœ¨å¿…è¦æ—¶è¿›è¡Œå®‰å…¨é€»è¾‘éªŒè¯ * é…ç½®ä»¥ä¸‹ä¸¤ä¸ªbean(DefaultAdvisorAutoProxyCreator(å¯é€‰)å’ŒAuthorizationAttributeSourceAdvisor)å³å¯å®ç°æ­¤åŠŸèƒ½ */ @Bean @DependsOn({\u0026#34;lifecycleBeanPostProcessor\u0026#34;}) public DefaultAdvisorAutoProxyCreator advisorAutoProxyCreator() { DefaultAdvisorAutoProxyCreator advisorAutoProxyCreator = new DefaultAdvisorAutoProxyCreator(); advisorAutoProxyCreator.setProxyTargetClass(true); return advisorAutoProxyCreator; } å…ƒç´ çš„ \u0026ldquo;proxy-target-class\u0026rdquo; å±æ€§å€¼æ¥æ§åˆ¶æ˜¯åŸºäºæ¥å£çš„è¿˜æ˜¯åŸºäºç±»çš„ä»£ç†è¢«åˆ›å»ºã€‚å¦‚æœ \u0026ldquo;proxy-target-class\u0026rdquo; å±å€¼è¢«è®¾ç½®ä¸º \u0026ldquo;true\u0026rdquo;ï¼Œé‚£ä¹ˆåŸºäºç±»çš„ä»£ç†å°†èµ·ä½œç”¨ï¼ˆè¿™æ—¶éœ€è¦CGLIBåº“cglib.jaråœ¨CLASSPATHä¸­ï¼‰ã€‚å¦‚æœ \u0026ldquo;proxy-target-class\u0026rdquo; å±å€¼è¢«è®¾ç½®ä¸º \u0026ldquo;false\u0026rdquo; æˆ–è€…è¿™ä¸ªå±æ€§è¢«çœç•¥ï¼Œé‚£ä¹ˆæ ‡å‡†çš„JDKåŸºäºæ¥å£çš„ä»£ç†å°†èµ·ä½œç”¨ã€‚\nå·¥å…· å¿«æ·æŸ¥çœ‹äº‹åŠ¡æ˜¯å¦ç”Ÿæ•ˆ\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 public class DebugUtils { private static final boolean transactionDebugging = true; private static final boolean verboseTransactionDebugging = true; public static void showTransactionStatus(String message) { System.out.println(((transactionActive()) ? \u0026#34;[+] \u0026#34; : \u0026#34;[-] \u0026#34;) + message); } // Some guidance from: \u0026lt;http://java.dzone.com/articles/monitoring-declarative-transac?page=0,1\u0026gt; public static boolean transactionActive() { try { ClassLoader contextClassLoader = Thread.currentThread().getContextClassLoader(); Class tsmClass = contextClassLoader.loadClass(\u0026#34;org.springframework.transaction.support.TransactionSynchronizationManager\u0026#34;); Boolean isActive = (Boolean) tsmClass.getMethod(\u0026#34;isActualTransactionActive\u0026#34;, null).invoke(null, null); return isActive; } catch (ClassNotFoundException e) { e.printStackTrace(); } catch (IllegalArgumentException e) { e.printStackTrace(); } catch (SecurityException e) { e.printStackTrace(); } catch (IllegalAccessException e) { e.printStackTrace(); } catch (InvocationTargetException e) { e.printStackTrace(); } catch (NoSuchMethodException e) { e.printStackTrace(); } // If we got here it means there was an exception throw new IllegalStateException(\u0026#34;ServerUtils.transactionActive was unable to complete properly\u0026#34;); } public static void transactionRequired(String message) { // Are we debugging transactions? if (!transactionDebugging) { // No, just return return; } // Are we doing verbose transaction debugging? if (verboseTransactionDebugging) { // Yes, show the status before we get to the possibility of throwing an exception showTransactionStatus(message); } // Is there a transaction active? if (!transactionActive()) { // No, throw an exception throw new IllegalStateException(\u0026#34;Transaction required but not active [\u0026#34; + message + \u0026#34;]\u0026#34;); } } } åœ¨éœ€è¦æ£€æµ‹çš„åœ°æ–¹\n1 DebugUtils.transactionRequired(\u0026#34;OperationUnitServiceImpl.testIn\u0026#34;); ","permalink":"https://habyss.github.io/posts/tech/transactional/","summary":"@Transactionalå¤±æ•ˆ æ•´åˆshiroä¹‹åï¼ŒUserRealmç±»é‡Œè‡ªåŠ¨æ³¨å…¥çš„serviceä¸­çš„@Transactionalæ³¨è§£å¤±æ•ˆ è§£","title":"@Transactionalå¤±æ•ˆæ’æŸ¥"},{"content":"$ref-fastjson é—®é¢˜æ’æŸ¥ é—®é¢˜æ’æŸ¥ é¡¹ç›®è¿”å›çš„æ•°æ®ä¸­å‡ºç°$refæ•°æ®\næŸ¥è¯¢å¾—çŸ¥æ˜¯fastjsonçš„ç‰¹æ€§å¾ªç¯å¼•ç”¨ fastjsonæ”¯æŒå¾ªç¯å¼•ç”¨ï¼Œå¹¶ä¸”æ˜¯ç¼ºçœæ‰“å¼€çš„ã€‚\nå½“åºåˆ—åŒ–åçš„JSONä¼ è¾“åˆ°æµè§ˆå™¨æˆ–è€…å…¶ä»–è¯­è¨€ä¸­ï¼Œè¿™äº›jsonè§£æå™¨ä¸æ”¯æŒå¾ªç¯å¼•ç”¨ï¼Œä»è€Œå¯¼è‡´æ•°æ®ä¸¢å¤±ã€‚ä½ å¯ä»¥å…³é—­fastjsonçš„å¾ªç¯å¼•ç”¨æ”¯æŒã€‚å…³é—­å¼•ç”¨æ£€æµ‹ï¼Œè¿˜èƒ½å¤Ÿæå‡åºåˆ—åŒ–æ—¶çš„æ€§èƒ½ã€‚\nå…¨å±€é…ç½®å…³é—­\n1 JSON.DEFAULT_GENERATE_FEATURE |= SerializerFeature.DisableCircularReferenceDetect.getMask(); éå…¨å±€å…³é—­\n1 JSON.toJSONString(obj, SerializerFeature.DisableCircularReferenceDetect); é¡¹ç›®ä¸­é…ç½®äº†å…¨å±€é»˜è®¤ä½¿ç”¨fastjson, æ‰€ä»¥å¯¼è‡´é»˜è®¤çš„jacksonä¸ç”Ÿæ•ˆ. $ref-fastjson-è§£å†³æ–¹æ¡ˆ å…¨å±€é…ç½®å…³é—­\néå…¨å±€å…³é—­\nåˆ é™¤å…¨å±€é»˜è®¤fastjson\n","permalink":"https://habyss.github.io/posts/tech/ref-fastjson/","summary":"$ref-fastjson é—®é¢˜æ’æŸ¥ é—®é¢˜æ’æŸ¥ é¡¹ç›®è¿”å›çš„æ•°æ®ä¸­å‡ºç°$refæ•°æ® æŸ¥è¯¢å¾—çŸ¥æ˜¯fastjsonçš„ç‰¹æ€§å¾ªç¯å¼•ç”¨ fastjsonæ”¯æŒå¾ªç¯å¼•ç”¨ï¼Œå¹¶ä¸”æ˜¯ç¼ºçœæ‰“å¼€çš„ã€‚ å½“","title":"$ref-fastjsonæ’æŸ¥"},{"content":"SpringBootä¸­æ—¶é—´æˆ³å’ŒLocalDateTimeç›¸å…³çš„æ¥æ”¶å’Œè½¬æ¢ å‰è¨€ ä¸€èˆ¬æƒ…å†µä¸‹, å‰ç«¯å’Œåç«¯åœ¨æ—¶é—´æ ¼å¼çš„ä¼ é€’ä¸Šéƒ½èµ°çš„æ˜¯æ—¶é—´æˆ³ï¼ˆæ–¹ä¾¿å‰ç«¯è‡ªç”±å®šåˆ¶ï¼‰ æ—¶é—´æ ¼å¼ç”±äºjava8çš„æ–°å¢æ—¶é—´å¤„ç†ç±»æ¯”è¾ƒå¥½ç”¨,è€Œä¸”æ›´åŠ çº¿ç¨‹å®‰å…¨, æ‰€ä»¥å°†é¡¹ç›®ä¸­çš„æ—¶é—´ç›¸å…³æ”¹ä¸ºLocalDateTimeï¼Œè€Œä¸æ˜¯ä¼ ç»Ÿçš„Date å‰ç½®è¦æ±‚ mybatiséœ€è¦3.4.6ä»¥ä¸Š, å¦åˆ™ä¼šä¸æ”¯æŒxmlå’ŒjavaTypeçš„è½¬æ¢ druidéœ€è¦æ¯”è¾ƒæ–°çš„ç‰ˆæœ¬, è¿™é‡Œä½¿ç”¨çš„æ˜¯1.1.21, å¦åˆ™æŸ¥è¯¢ä¼šæŠ¥é”™,ç»“æœé›†result setä¸­æ‰¾ä¸åˆ°å…ƒç´  æ­£æ–‡ è¯·æ±‚æ–¹å¼çš„æƒ…å†µåˆ†ç±»\n@RequestBodyä¸­ä¿®é¥°LocalDateTime å…¶ä»–, æ¯”å¦‚@RequestParamå’Œ@PathVariableä»¥åŠä¸åŠ æ³¨è§£çš„å•å‚æ•°å’Œå¯¹è±¡å‚æ•° æƒ…å†µä¸€. @RequestBodyä¸­çš„LocalDateTime é€šè¿‡@RequestBodyå¾ˆæ˜æ˜¾çš„å°±æ˜¯è¦é€šè¿‡JSONåºåˆ—åŒ–è¿›è¡Œå¤„ç†ï¼ŒSpringé»˜è®¤çš„æ˜¯Jacksonè¿›è¡Œå¤„ç†ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å¯¹é»˜è®¤çš„JSONå¤„ç†å™¨è¿›è¡Œæ—¥æœŸç±»å‹çš„æ·»åŠ (å‡å¦‚é»˜è®¤ä¸å¸¦å¯¹åº”åºåˆ—åŒ–å™¨çš„æƒ…å†µä¸‹)\næ­¤æ—¶éœ€è¦ç”¨çš„æ˜¯JsonDeserializerè¿™ä¸ªç±»ï¼Œå¯¹åº”çš„å®ç°å¦‚ä¸‹æ‰€ç¤ºï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 /** * å…¥å‚ æ—¶é—´æˆ³ -\u0026gt; LocalDateTime */ public class CustomDateDeserializer { public static class LocalDateTimeDeserializer extends JsonDeserializer\u0026lt;LocalDateTime\u0026gt; { @Override public LocalDateTime deserialize(JsonParser p, DeserializationContext context) throws IOException { Long timestamp = Long.valueOf(p.getText()); Instant instant = Instant.ofEpochMilli(timestamp); return LocalDateTime.ofInstant(instant, ZoneId.systemDefault()); } } } /** * @author kun.han on 2020/3/4 15:45 * è¿”å›å‚æ•° LocalDateTime -\u0026gt; æ—¶é—´æˆ³ */ public class CustomDateSerializer { public static class LocalDateTimeSerializer extends JsonSerializer\u0026lt;LocalDateTime\u0026gt; { @Override public void serialize(LocalDateTime localDateTime, JsonGenerator jsonGenerator, SerializerProvider serializerProvider) throws IOException { jsonGenerator.writeNumber(localDateTime.toInstant(ZoneOffset.of(\u0026#34;+8\u0026#34;)).toEpochMilli()); } } } æœ‰äº†è¿™ä¸ªäº†ç±»ï¼Œè¿˜éœ€è¦æ·»åŠ åˆ°Springä¸­ï¼ŒSpringåˆ©ç”¨çš„æ˜¯ObjectMapperï¼Œæˆ‘ä»¬è‡ªå®šä¹‰ä¸€ä¸ªObjectMapperæ›¿æ¢åŸæœ¬çš„å°±å¯ä»¥äº†ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 @Configuration public class CustomDateConfig implements WebMvcConfigurer { /** * Jsonåºåˆ—åŒ–å’Œååºåˆ—åŒ–è½¬æ¢å™¨ï¼Œç”¨äºè½¬æ¢Postè¯·æ±‚ä½“ä¸­çš„jsonä»¥åŠå°†æˆ‘ä»¬çš„å¯¹è±¡åºåˆ—åŒ–ä¸ºè¿”å›å“åº”çš„json */ @Bean public ObjectMapper objectMapper() { ObjectMapper objectMapper = new ObjectMapper(); //ä¸æ˜¾ç¤ºä¸ºnullçš„å­—æ®µ objectMapper.disable(SerializationFeature.FAIL_ON_EMPTY_BEANS); objectMapper.disable(DeserializationFeature.FAIL_ON_UNKNOWN_PROPERTIES); // å¿½ç•¥ä¸èƒ½è½¬ç§»çš„å­—ç¬¦ objectMapper.configure(JsonParser.Feature.ALLOW_BACKSLASH_ESCAPING_ANY_CHARACTER, true); // è¿‡æ»¤å¯¹è±¡çš„nullå±æ€§. objectMapper.setSerializationInclusion(JsonInclude.Include.NON_NULL); //å¿½ç•¥transient objectMapper.configure(MapperFeature.PROPAGATE_TRANSIENT_MARKER, true); objectMapper.disable(DeserializationFeature.ADJUST_DATES_TO_CONTEXT_TIME_ZONE); //LocalDateTimeç³»åˆ—åºåˆ—åŒ–å’Œååºåˆ—åŒ–æ¨¡å—ï¼Œç»§æ‰¿è‡ªjsr310ï¼Œæˆ‘ä»¬åœ¨è¿™é‡Œä¿®æ”¹äº†æ—¥æœŸæ ¼å¼ JavaTimeModule javaTimeModule = new JavaTimeModule(); // LocalDateTime è¿™é‡Œåªéœ€è¦LocalDateTime å¦‚æœéœ€è¦è½¬å…¶ä»–çš„,ç›¸åº”æ”¾å¼€æ³¨é‡Š, å¹¶åœ¨ä¸Šé¢ä¸¤ä¸ªç±»ä¸­é€‚å½“ä¿®æ”¹ javaTimeModule.addSerializer(LocalDateTime.class, new CustomDateSerializer.LocalDateTimeSerializer()); javaTimeModule.addDeserializer(LocalDateTime.class,new CustomDateDeserializer.LocalDateTimeDeserializer()); // // LocalDate // javaTimeModule.addSerializer(LocalDate.class, new CustomDateSerializer.LocalDateSerializer()); // javaTimeModule.addDeserializer(LocalDate.class, new CustomDateDeserializer.LocalDateDeserializer()); // //Dateåºåˆ—åŒ–å’Œååºåˆ—åŒ– // javaTimeModule.addSerializer(Date.class,new CustomDateSerializer.DateSerializer()); // javaTimeModule.addDeserializer(Date.class,new CustomDateDeserializer.DateDeserializer()); objectMapper.registerModule(javaTimeModule); return objectMapper; } } æƒ…å†µäºŒ. å…¶ä»– æ¯”å¦‚@RequestParamå’Œ@PathVariableä»¥åŠä¸åŠ æ³¨è§£çš„å•å‚æ•°å’Œå¯¹è±¡å‚æ•° æ–¹å¼ä¸€: Convert å¯ä»¥æ ¹æ®è‡ªèº«éœ€æ±‚è¿›è¡Œå®šåˆ¶ï¼Œè¿™é‡Œæˆ‘é€šè¿‡Convertè½¬æ¢LocalDateTimeä¸ºä¾‹ï¼Œè¿›è¡Œè½¬æ¢ï¼š\n1 2 3 4 5 6 7 8 9 public class CustomDateConverter { public static class LocalDateConvert implements Converter\u0026lt;String, LocalDateTime\u0026gt; { @Override public LocalDateTime convert(String timestamp) { return LocalDateTime.ofInstant(Instant.ofEpochMilli(Long.parseLong(timestamp)), ZoneId.systemDefault()); } } } åŒæ ·çš„éœ€è¦åœ¨é…ç½®ç±»ä¸­å¼•ç”¨\n1 2 3 4 5 6 7 8 @Configuration public class CustomDateConfig implements WebMvcConfigurer { @Bean public Converter\u0026lt;String, LocalDateTime\u0026gt; localDateConverter() { //æ­¤å¤„ä¸èƒ½æ›¿æ¢ä¸ºlambdaè¡¨è¾¾å¼ return new CustomDateConverter.LocalDateConvert(); } } æ–¹å¼äºŒ: ControllerAdvice 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 /** * requestBodyä¹‹å¤–çš„å…¥å‚ æ—¶é—´æˆ³-\u0026gt;LocalDateTime * * @author hankun */ @ControllerAdvice public class LocalDateTimeAdvice { @InitBinder protected void initBinder(WebDataBinder binder) { // è¿™é‡Œåªéœ€è¦LocalDateTime å¦‚æœéœ€è¦è½¬å…¶ä»–çš„,ç›¸åº”æ·»åŠ /ä¿®æ”¹ binder.registerCustomEditor(LocalDateTime.class, new PropertyEditorSupport() { @Override public void setAsText(String timestamp) throws IllegalArgumentException { if (!StringUtils.hasText(timestamp)) { setValue(null); } else { setValue(LocalDateTime.ofInstant(Instant.ofEpochMilli(Long.parseLong(timestamp)), ZoneId.systemDefault())); } } }); // è¿™é‡Œåªéœ€è¦LocalDateTime å¦‚æœéœ€è¦è½¬å…¶ä»–çš„,ç›¸åº”æ·»åŠ /ä¿®æ”¹ binder.registerCustomEditor(LocalDate.class, new PropertyEditorSupport() { @Override public void setAsText(String timestamp) throws IllegalArgumentException { if (!StringUtils.hasText(timestamp)) { setValue(null); } else { setValue(LocalDate.ofInstant(Instant.ofEpochMilli(Long.parseLong(timestamp)), ZoneId.systemDefault())); } } }); } } ç›¸å…³çŸ¥è¯†ç‚¹ æ—¶é—´å·® ç²¾ç¡®æ—¶é—´å·®:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 long start = 1584328558000L; long now = 1584400558000L; Instant startTime = Instant.ofEpochMilli(start); LocalDateTime startTimeT = LocalDateTime.ofInstant(startTime, ZoneId.systemDefault()); Instant endTime = Instant.ofEpochMilli(now); LocalDateTime entTimeT = LocalDateTime.ofInstant(startTime, ZoneId.systemDefault()); Duration duration = Duration.between(startTimeT, entTimeT); // Duration duration = Duration.between(startTime, entTime); long day = duration.toDays(); long hours = duration.toHours(); long min = duration.toMinutes(); long millis= duration.toMillis(); long nanos = duration.toNanos(); ç²—ç•¥æ—¶é—´å·®, æ¯”å¦‚ä»Šå¤©æ˜å¤©ç®—ä¸€å¤©\n1 2 3 4 5 6 7 8 9 10 11 long start = 1584328558000L; long now = 1584400558000L; Instant startTime = Instant.ofEpochMilli(start); LocalDate startTimeT = LocalDateTime.ofInstant(startTime, ZoneId.systemDefault()).toLocalDate(); Instant endTime = Instant.ofEpochMilli(now); LocalDate entTimeT = LocalDateTime.ofInstant(startTime, ZoneId.systemDefault()).toLocalDate(); Period period = Period.between(startTimeT, entTimeT); int years = period.getYears(); int months = period.getMonths(); int days = period.getDays(); ","permalink":"https://habyss.github.io/posts/tech/springboot_localdatetime/","summary":"SpringBootä¸­æ—¶é—´æˆ³å’ŒLocalDateTimeç›¸å…³çš„æ¥æ”¶å’Œè½¬æ¢ å‰è¨€ ä¸€èˆ¬æƒ…å†µä¸‹, å‰ç«¯å’Œåç«¯åœ¨æ—¶é—´æ ¼å¼çš„ä¼ é€’ä¸Šéƒ½èµ°çš„æ˜¯æ—¶é—´æˆ³ï¼ˆæ–¹ä¾¿å‰ç«¯","title":"SpringBootä¸­æ—¶é—´æˆ³å’ŒLocalDateTimeç›¸å…³çš„æ¥æ”¶å’Œè½¬æ¢"},{"content":"å°é¹¤åŒæ‹¼ æ–¹æ¡ˆä¸€ win + Rï¼Œè¾“å…¥ regeditï¼Œæ‰“å¼€æ³¨å†Œè¡¨\næ‰¾åˆ° è®¡ç®—æœº\\HKEY_CURRENT_USER\\Software\\Microsoft\\InputMethod\\Settings\\CHS é¡¹\næ–°å»ºä¸€ä¸ªåä¸º UserDefinedDoublePinyinScheme0 çš„å­—ç¬¦ä¸²å€¼ï¼Œå€¼ä¸º\n1 å°é¹¤åŒæ‹¼*2*^*iuvdjhcwfg^xmlnpbksqszxkrltvyovt æ–¹æ¡ˆäºŒ æ–°å»ºæ–‡æœ¬æ–‡ä»¶\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 Windows Registry Editor Version 5.00 [HKEY_CURRENT_USER\\SOFTWARE\\Microsoft\\InputMethod\\Settings\\CHS] \u0026#34;EnableExtraDomainType\u0026#34;=dword:00000001 \u0026#34;EnableSmartSelfLearning\u0026#34;=dword:00000000 \u0026#34;EnableVMode\u0026#34;=dword:00000000 \u0026#34;EnableHap\u0026#34;=dword:00000000 \u0026#34;EnablePeopleName\u0026#34;=dword:00000000 \u0026#34;DoublePinyinScheme\u0026#34;=dword:0000000a \u0026#34;EnableUMode\u0026#34;=dword:00000000 \u0026#34;EnableSmartFuzzyPinyin\u0026#34;=dword:00000000 \u0026#34;UserDefinedDoublePinyinScheme0\u0026#34;=\u0026#34;å°é¹¤åŒæ‹¼*2*^*iuvdjhcwfg^xmlnpbksqszxkrltvyovt\u0026#34; \u0026#34;Enable Dynamic Candidate Ranking\u0026#34;=dword:00000000 \u0026#34;Enable self-learning\u0026#34;=dword:00000000 \u0026#34;Expand Double Pinyin\u0026#34;=dword:00000000 \u0026#34;Enable Double Pinyin\u0026#34;=dword:00000001 \u0026#34;LangBar Force On\u0026#34;=dword:00000000 \u0026#34;PinyinMixEnable\u0026#34;=dword:00000000 \u0026#34;ToolBarEnabled\u0026#34;=dword:00000000 é‡å‘½å.reg, å¹¶è¿è¡Œ\n","permalink":"https://habyss.github.io/posts/tool/%E5%B0%8F%E9%B9%A4%E5%8F%8C%E6%8B%BC/","summary":"å°é¹¤åŒæ‹¼ æ–¹æ¡ˆä¸€ win + Rï¼Œè¾“å…¥ regeditï¼Œæ‰“å¼€æ³¨å†Œè¡¨ æ‰¾åˆ° è®¡ç®—æœº\\HKEY_CURRENT_USER\\Software\\Microsoft\\I","title":"å°é¹¤åŒæ‹¼"},{"content":"Mysql-explain id idç›¸åŒæ—¶, æ‰§è¡Œé¡ºåºç”±ä¸Šè€Œä¸‹ idä¸åŒæ—¶, æ‰§è¡Œé¡ºåºç”±å¤§åˆ°å°, ä¸€èˆ¬ä¸ºå­æŸ¥è¯¢ select_type æŸ¥è¯¢ç±»å‹, å¸¸è§çš„å€¼æœ‰:\nSIMPLE: ç®€å•æŸ¥è¯¢, ä¸åŒ…å«UNIONæˆ–è€…å­æŸ¥è¯¢ PRIMARY: æŸ¥è¯¢ä¸­å¦‚æœåŒ…å«å­æŸ¥è¯¢æˆ–å…¶ä»–éƒ¨åˆ†, åˆ™å¤–å±‚çš„SELECTå°†è¢«æ ‡è®°ä¸ºPRIMARY SUBQUERY: å­æŸ¥è¯¢ä¸­çš„ç¬¬ä¸€ä¸ªSELECT NUION: åœ¨UNIONè¯­å¥ä¸­, UNIONä¹‹åå‡ºç°çš„SELECT DERIVED: åœ¨FROMä¸­å‡ºç°çš„å­æŸ¥è¯¢ UNION RESULT: UNIONæŸ¥è¯¢çš„ç»“æœ table å½“å‰çš„æ•°æ®è¡¨\npartitions æŸ¥è¯¢æ‰€åŒ¹é…è®°å½•çš„åˆ†åŒº, å¯¹äºæœªåˆ†åŒºçš„è¡¨, å€¼ä¸ºNULL\ntype æŸ¥è¯¢æ‰§è¡Œçš„ç±»å‹, æœ€ä¼˜æ’è¡Œ\nsystem \u0026gt; const \u0026gt; eq_ref \u0026gt; ref \u0026gt; fulltext \u0026gt; ref_or_null \u0026gt; index_merge \u0026gt; unique_subquery \u0026gt; index_subquery \u0026gt; range \u0026gt; index \u0026gt; ALL\nsystem: è¡¨ä¸­åªæœ‰ä¸€è¡Œæ•°æ®, æ˜¯constçš„ä¸€ç§ç‰¹ä¾‹ const: è¡¨ä¸­æœ€å¤šåªæœ‰ä¸€è¡ŒåŒ¹é…çš„è®°å½• eq_ref: è¿è¡¨æŸ¥è¯¢æ—¶, å‰ä¸€å¼ è¡¨çš„è¡Œåœ¨å½“å‰è¡¨ä¸­åªæœ‰ä¸€è¡Œä¸ä¹‹å¯¹åº”(é™¤äº†systemä¸constæœ€å¥½çš„è¿è¡¨æ–¹å¼) ref: ä½¿ç”¨æ™®é€šç´¢å¼•ä½œä¸ºæŸ¥è¯¢æ¡ä»¶, æŸ¥è¯¢ç»“æœå¯èƒ½æ‰¾åˆ°å¤šè¡ŒåŒ¹é…çš„è®°å½• fulltext: å…¨æ–‡ç´¢å¼• ref_or_null: ä½¿ç”¨æ™®é€šç´¢å¼•ä½œä¸ºæŸ¥è¯¢æ¡ä»¶ , æŸ¥è¯¢ç»“æœå¯èƒ½æ‰¾åˆ°å¤šè¡ŒåŒ¹é…çš„è®°å½•, è¿˜æŸ¥è¯¢äº†å€¼ä¸ºNULLçš„è¡Œ index_merge: å½“æŸ¥è¯¢æ¡ä»¶ä½¿ç”¨å¤šä¸ªç´¢å¼•æ—¶, index_mergeè¡¨ç¤ºå¼€å¯äº†Index Mergeä¼˜åŒ– unique_subquery: eq_refç±»ä¼¼, åœ¨ä¸€äº›ä½¿ç”¨INçš„å­æŸ¥è¯¢ä¸­, ä½¿ç”¨å”¯ä¸€ç´¢å¼• index_subquery: ä¸unique_subqueryç±»ä¼¼, åœ¨INå­æŸ¥è¯¢ä¸­, ä½¿ç”¨äº†æ™®é€šç´¢å¼• range: å¯¹ç´¢å¼•åˆ—è¿›è¡ŒèŒƒå›´æŸ¥è¯¢ index: æŸ¥è¯¢ä¾¿åˆ©äº†æ•´ä¸ªç´¢å¼•æ ‘, ALL: éå†å…¨è¡¨, å¾ˆå¯èƒ½è¯»ç£ç›˜, é€Ÿåº¦æœ€æ…¢ possible_key å¯èƒ½è¢«ä½¿ç”¨çš„ç´¢å¼•, ä¸ä¸€å®šè¢«æŸ¥è¯¢å®é™…ä½¿ç”¨\nkey æŸ¥è¯¢ä¸­å®é™…ä½¿ç”¨åˆ°çš„ç´¢å¼•, å¦‚æœä¸ºNULL, åˆ™è¡¨ç¤ºä¸ºå»ºç«‹ç´¢å¼•æˆ–ç´¢å¼•å¤±æ•ˆ\nkey_len æŸ¥è¯¢ç´¢å¼•æ—¶ä½¿ç”¨çš„å­—èŠ‚æ•°, åœ¨æ»¡è¶³å‰æçš„éœ€æ±‚ä¸‹, è¶Šå°è¶Šå¥½\nref åœ¨æŸ¥è¯¢ç´¢å¼•æ—¶, é‚£äº›åˆ—æˆ–å¸¸é‡è¢«ç”¨æ¥ä¸ç´¢å¼•å€¼æ¯”è¾ƒ\nrows å¯èƒ½æŸ¥è¯¢æ—¶éœ€è¦éå†çš„è¡Œæ•°\nfiltered ä¼°ç®—ç»è¿‡æŸ¥è¯¢æ¡ä»¶ç­›é€‰å‡ºçš„åˆ—æ•°çš„ç™¾åˆ†æ¯”\nExtra æŸ¥è¯¢æ—¶çš„é¢å¤–ä¿¡æ¯\nå½“åŒ…å«Using filesortæˆ–Using temporary, éœ€è¦ä¼˜åŒ–\nUsing filesort: åœ¨æ’åºæ—¶ä½¿ç”¨äº†å¤–éƒ¨çš„ç´¢å¼•æ’åº, æ²¡æœ‰ä½¿ç”¨è¡¨å†…çš„ç´¢å¼•è¿›è¡Œæ’åº Using temporary: éœ€è¦åˆ›å»ºä¸´æ—¶è¡¨æ¥å­˜å‚¨æŸ¥è¯¢çš„ç»“æœ, å¸¸è§äºORDER BYå’ŒGROUP BY Using index: ä½¿ç”¨äº†ç´¢å¼•è¦†ç›–, æŸ¥è¯¢æ•ˆç‡éå¸¸é«˜ Using where: ä½¿ç”¨äº†WHEREå­å¥è¿›è¡Œæ¡ä»¶è¿‡æ»¤, ä¸€èˆ¬åœ¨æ²¡æœ‰ä½¿ç”¨åˆ°ç´¢å¼•çš„æ—¶å€™å‡ºç° Impossible where: è¡¨ç¤ºwhereå­å¥çš„ç»“æœæ€»æ˜¯falseä¸”æ— æ³•æŸ¥åˆ°ä»»æ„è¡Œ Using join buffer(Block Nested Loop): è¿è¡¨æŸ¥è¯¢æ—¶, å½“è¢«é©±åŠ¨è¡¨æ²¡æœ‰ä½¿ç”¨ç´¢å¼•æ—¶, ä¼šå…ˆå°†é©±åŠ¨è¡¨è¯»åˆ°join bufferä¸­, å†éå†è¢«é©±åŠ¨è¡¨ä¸é©±åŠ¨è¡¨è¿›è¡ŒæŸ¥è¯¢ Using json buffer(Batched Key Access): ä¸Using join buffer(Block Nested Loop)ç±»ä¼¼, ä½¿ç”¨çš„æ˜¯BKAç®—æ³•\u0026ndash; å‰ææ˜¯è¢«é©±åŠ¨è¡¨æœ‰ç´¢å¼•å¯ç”¨ ","permalink":"https://habyss.github.io/posts/tech/mysql_explain/","summary":"Mysql-explain id idç›¸åŒæ—¶, æ‰§è¡Œé¡ºåºç”±ä¸Šè€Œä¸‹ idä¸åŒæ—¶, æ‰§è¡Œé¡ºåºç”±å¤§åˆ°å°, ä¸€èˆ¬ä¸ºå­æŸ¥è¯¢ select_type æŸ¥è¯¢ç±»å‹, å¸¸è§çš„å€¼æœ‰: SIMPLE: ç®€å•æŸ¥è¯¢, ä¸åŒ…å«UNIONæˆ–è€…å­æŸ¥è¯¢ PRIMARY: æŸ¥","title":"Mysql Explain ç®€è§£"},{"content":"Hugo+Github Pages 1. å®‰è£…Scoop winç³»ç»Ÿ, åœ¨hugoå®˜ç½‘ä¸­ä¹Ÿæ¨èäº†ä½¿ç”¨Scoopæ¥è¿›è¡ŒåŒ…ç®¡ç†\næ‰“å¼€PowerShellå¹¶è¿è¡Œ, ä¿è¯å…è®¸æœ¬åœ°è„šæœ¬çš„æ‰§è¡Œ\n1 set-executionpolicy remotesigned -scope currentuser æ‰§è¡Œå®‰è£…å‘½ä»¤\n1 iex (new-object net.webclient).downloadstring(\u0026#39;https://get.scoop.sh\u0026#39;) å®‰è£…æˆåŠŸéªŒè¯\n1 scoop help 2. å®‰è£…Hugo å®‰è£…Hugoçš„extendç‰ˆæœ¬\n1 scoop install hugo-extended å®‰è£…æˆåŠŸéªŒè¯\n1 hugo version 3. åˆ›å»ºBlog hugo new site MyBlog -f yml ä¸‹è½½zipè§£å‹åˆ°themes, å¹¶é‡å‘½åä¸ºPaperMod ä¿®æ”¹config.yml https://shaohanyun.top/posts/env/blog_build2/\nhttps://www.sulvblog.cn/posts/blog/build_hugo/\n","permalink":"https://habyss.github.io/posts/tech/%E6%B5%8B%E8%AF%95/","summary":"Hugo+Github Pages 1. å®‰è£…Scoop winç³»ç»Ÿ, åœ¨hugoå®˜ç½‘ä¸­ä¹Ÿæ¨èäº†ä½¿ç”¨Scoopæ¥è¿›è¡ŒåŒ…ç®¡ç† æ‰“å¼€PowerShellå¹¶è¿è¡Œ, ä¿è¯å…è®¸æœ¬åœ°è„šæœ¬çš„æ‰§è¡Œ 1 set-executionpolicy","title":"æµ‹è¯•"}]